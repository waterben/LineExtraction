"""qplot - Qt plotting library

Note: This library requires Qt5. Build with --//bazel:enable_qt5=true to include it.
"""

load("@rules_cc//cc:defs.bzl", "cc_library")
load("//bazel:features.bzl", "if_qt5_enabled")
load("//tools/bazel:qt5.bzl", "qt5_moc")

package(default_visibility = ["//visibility:public"])

# Qt5 system include paths (required since copts don't propagate transitively)
QT5_COPTS = [
    "-isystem/usr/include/x86_64-linux-gnu/qt5",
    "-isystem/usr/include/x86_64-linux-gnu/qt5/QtCore",
    "-isystem/usr/include/x86_64-linux-gnu/qt5/QtGui",
    "-isystem/usr/include/x86_64-linux-gnu/qt5/QtWidgets",
    "-isystem/usr/include/x86_64-linux-gnu/qt5/QtPrintSupport",
    "-fPIC",
]

# MOC headers for Qt signal/slot support
qt5_moc(
    name = "qplot_moc",
    hdrs = [
        "include/qplot/PlotWindow.h",
        "include/qplot/qcustomplot.h",
    ],
    includes = [
        "include",
        "third-party/qplot/include",
    ],
    deps = glob(["include/qplot/*.h"]),
)

cc_library(
    name = "lib_qplot",
    srcs = if_qt5_enabled([
        "src/PlotManager.cpp",
        "src/PlotWindow.cpp",
        "src/qcustomplot.cpp",
        # MOC-generated files
        ":qplot_moc",
    ]),
    hdrs = if_qt5_enabled(
        glob([
            "include/qplot/*.h",
        ]),
    ),
    copts = select({
        "//bazel:qt5_enabled": QT5_COPTS,
        "//conditions:default": [],
    }),
    includes = ["include"],
    tags = ["qt5"],
    deps = if_qt5_enabled([
        "//libs/geometry:lib_geometry",
        "@opencv",
        "@qt5//:qt5_core",
        "@qt5//:qt5_gui",
        "@qt5//:qt5_printsupport",
        "@qt5//:qt5_widgets",
    ]),
)
